# PHPVibe_vulnerability_Arbitrary-File-Write
Description about PHPVibeCms' vulnerability
# Arbitrary File Write vulnerability

This **Arbitrary File Write** vulnerability was find in file **./app/uploading/upload-ffmpeg.php, ./app/uploading/upload-mp3.php and ./app/uploading/upload.php**. In these files, parameters from http requests are not strictly filtered, leading to the vulnerability.

The attacker can carefully construct a GET request packet containing a param ‘token’ and special headers, thus causing path traversal and writing files with the specified suffix to any web path.

The following file 'upload-ffmpeg.php' is used as a replicated example, which shows the cause of the vulnerability and details of debugging the vulnerability.

Use the following poc to access upload-ffmpeg.php

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/44bc7138-5a33-49a6-8ac8-60bb45a50097)


In the debug window, you can see that $new_name gets the full contents of the token.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/adf5e45c-5dda-4550-a40e-0aad6698603a)


The $target_path is by default, $new_name comes from $token, and $ext is the suffix of $fileName. Combining the first parameter of fopen, you can get the output path as follows.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/ba6e6899-1cae-4692-8da2-4909a5e485b0/7d245ace-4844-489c-aac9-3dc86d77e4e6/Untitled.png)

Eventually, the file is written to .htaccess in the web root directory.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/ba6e6899-1cae-4692-8da2-4909a5e485b0/cf3285ab-0e5e-45c5-9d75-1f16144761d5/Untitled.png)

We can see that the POST data is added at the end.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/ba6e6899-1cae-4692-8da2-4909a5e485b0/d9ab6f68-2cf6-4a4b-b3c3-2a5bf8967d3b/Untitled.png)

Since cms uses .htaccess for Rewrite by default, writing .htaccess is absolutely valid!

Use the same logic to write the php code to the .png file.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/ba6e6899-1cae-4692-8da2-4909a5e485b0/e7d31bb7-2103-4e26-af2c-b2d352e4dadc/Untitled.png)

The .png file is parsed and executed.
